"use strict";angular.module("luckStatApp",["ngCookies","ngResource","ngSanitize","ngRoute","underscore","luckNumServices"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/partials/main.html"}).when("/stat",{templateUrl:"views/partials/stat.html",controller:"StatCtrl"}).when("/chance",{templateUrl:"views/partials/chance.html",controller:"ChanceCtrl"}).when("/formula",{templateUrl:"views/partials/formula.html",controller:"FormulaCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("luckStatApp").controller("StatCtrl",["$scope","Records","_",function(a,b,c){a.numbers=[];var d=[],e=b.query(),f={name:"BC 649",numofDraw:6,numoBonus:1,poolMin:1,poolMax:49};a.selectedNumber=[],a.enoughSelection=!1,a.numberEmpty=!0,a.numofMore=f.numofDraw;for(var g=f.poolMin;g<=f.poolMax;g++)a.numbers.push({value:g,selected:!1});var h=function(a,b){return a.length===c.intersection(b,a).length},i=function(){d=[];for(var b=[],c=0,f=null,g=0,i=a.selectedNumber.length,j=0;i>j;j++)b.push(a.selectedNumber[j].value);$.each(e,function(a,e){f=new Date(e.date);var i=h(b,e.numbers);c===f.getMonth()?i&&g++:(c=f.getMonth(),d.push({date:f.setDate(1),isWinningNumber:g}),g=0)})},j=function(){paintChart(d)};a.selectNumber=function(b){if(-1!==c.indexOf(a.selectedNumber,b))b.selected=!1,a.selectedNumber=c.without(a.selectedNumber,b);else{if(a.selectedNumber.length===f.numofDraw)return;b.selected=!0,a.selectedNumber.push(b)}a.enoughSelection=a.selectedNumber.length===f.numofDraw?!0:!1,a.numberEmpty=0===a.selectedNumber.length?!0:!1,a.numofMore=f.numofDraw-a.selectedNumber.length,i(),j()}}]),angular.module("luckStatApp").controller("ChanceCtrl",["$scope","Records","_",function(a,b,c){a.numbers=[];var d=[],e=b.query(),f={name:"BC 649",numofDraw:1,poolMin:1,poolMax:49};a.selectedNumber=[],a.numOfAppear=0,a.totalDraw=0,a.numberEmpty=!0;for(var g=f.poolMin;g<=f.poolMax;g++)a.numbers.push({value:g,selected:!1});var h=function(a,b){return a.length===c.intersection(b,a).length},i=function(){d=[];for(var b=[],c=0,f=null,g=0,i=a.selectedNumber.length,j=0;i>j;j++)b.push(a.selectedNumber[j].value);$.each(e,function(e,i){f=new Date(i.date);var j=h(b,i.numbers);c!==f.getMonth()&&(c=f.getMonth(),d.push({date:f.setDate(1),isWinningNumber:g}),g=0),j&&(g++,a.numOfAppear++),a.totalDraw++}),a.percentageDraw=(a.numOfAppear/a.totalDraw*100).toFixed(2)+"%"},j=function(){paintChart(d)};a.selectNumber=function(b){a.selectedNumber.length>=f.numofDraw&&(a.selectedNumber[0].selected=!1,a.selectedNumber=[]),b.selected=!0,a.numOfAppear=0,a.totalDraw=0,a.selectedNumber.push(b),a.numberEmpty=!1,i(),j()}}]);var luckNumServices=angular.module("luckNumServices",["ngResource"]);luckNumServices.factory("Records",["$resource",function(a){return a("data/649.json",{},{query:{method:"GET",isArray:!0}})}]);var paintChart=function(a){function b(){h.domain(o.empty()?i.domain():o.extent()),s.select(".area").attr("d",p),s.select(".x.axis").call(l)}var c={top:10,right:10,bottom:100,left:40},d={top:430,right:10,bottom:20,left:40},e=$(document).width();e=e>700?700:e,e=e-c.left-c.right;var f=$(document).height();f=f>500?500:f;var g=f-d.top-d.bottom;f=f-c.top-c.bottom;var h=d3.time.scale().range([0,e]),i=d3.time.scale().range([0,e]),j=d3.scale.linear().range([f,0]),k=d3.scale.linear().range([g,0]),l=d3.svg.axis().scale(h).orient("bottom"),m=d3.svg.axis().scale(i).orient("bottom"),n=d3.svg.axis().scale(j).orient("left"),o=d3.svg.brush().x(i).on("brush",b),p=d3.svg.area().interpolate("monotone").x(function(a){return h(a.date)}).y0(f).y1(function(a){return j(a.isWinningNumber)}),q=d3.svg.area().interpolate("monotone").x(function(a){return i(a.date)}).y0(g).y1(function(a){return k(a.isWinningNumber)});d3.select("svg").remove();var r=d3.select("#chartContent").append("svg").attr("width",e+c.left+c.right).attr("height",f+c.top+c.bottom);r.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e).attr("height",f);var s=r.append("g").attr("class","focus").attr("transform","translate("+c.left+","+c.top+")"),t=r.append("g").attr("class","context").attr("transform","translate("+d.left+","+d.top+")");h.domain(d3.extent(a.map(function(a){return a.date}))),j.domain([0,d3.max(a.map(function(a){return a.isWinningNumber}))]),i.domain(h.domain()),k.domain(j.domain()),s.append("path").datum(a).attr("class","area").attr("d",p),s.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(l),s.append("g").attr("class","y axis").call(n),t.append("path").datum(a).attr("class","area").attr("d",q),t.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(m),t.append("g").attr("class","x brush").call(o).selectAll("rect").attr("y",-6).attr("height",g+7)};