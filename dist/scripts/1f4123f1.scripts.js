"use strict";angular.module("luckStatApp",["ngCookies","ngResource","ngSanitize","ngRoute","underscore","luckNumServices"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/partials/main.html"}).when("/stat",{templateUrl:"views/partials/stat.html",controller:"StatCtrl"}).when("/chance",{templateUrl:"views/partials/chance.html",controller:"ChanceCtrl"}).when("/formula",{templateUrl:"views/partials/formula.html",controller:"FormulaCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("luckStatApp").controller("StatCtrl",["$scope","Records","_",function(a,b,c){a.numbers=[];var d=b.query(),e={name:"BC 649",numofDraw:6,numoBonus:1,poolMin:1,poolMax:49};a.selectedNumber=[],a.enoughSelection=!1,a.numberEmpty=!0,a.numofMore=e.numofDraw;for(var f=e.poolMin;f<=e.poolMax;f++)a.numbers.push({value:f,selected:!1});var g=function(a,b){return a.length===c.intersection(b,a).length?1:0},h=function(){for(var b=[],c=null,e=null,f=a.selectedNumber.length,h=0;f>h;h++)b.push(a.selectedNumber[h].value);$.each(d,function(d,f){e=new Date(f.date);var h=g(b,f.numbers),i=null;a.numOfAppear+=h,a.totalDraw++;var j={};c===e.getMonth()?j.isWinningNumber+=h:(c=e.getMonth(),j={date:e.setDate(1),isWinningNumber:h},a.luckRecords.push(j)),1===h&&(i=new Date(e),a.winningRecords.push({winningDate:i.getMonth()+"/"+i.getDate()+"/"+i.getFullYear()}))})},i=function(){paintChart(a.luckRecords)};a.selectNumber=function(b){if(-1!==c.indexOf(a.selectedNumber,b))b.selected=!1,a.selectedNumber=c.without(a.selectedNumber,b);else{if(a.selectedNumber.length===e.numofDraw)return;b.selected=!0,a.selectedNumber.push(b)}a.enoughSelection=a.selectedNumber.length===e.numofDraw?!0:!1,a.numberEmpty=0===a.selectedNumber.length?!0:!1,a.numofMore=e.numofDraw-a.selectedNumber.length,a.numOfAppear=0,a.totalDraw=0,a.luckRecords=[],a.winningRecords=[],h(),i(),a.percentageDraw=(a.numOfAppear/a.totalDraw*100).toFixed(8)+"%"}}]),angular.module("luckStatApp").controller("ChanceCtrl",["$scope","Records","_",function(a,b,c){a.numbers=[];var d=[],e=b.query(),f={name:"BC 649",numofDraw:1,poolMin:1,poolMax:49};a.selectedNumber=[],a.numOfAppear=0,a.totalDraw=0,a.numberEmpty=!0;for(var g=f.poolMin;g<=f.poolMax;g++)a.numbers.push({value:g,selected:!1});var h=function(a,b){return a.length===c.intersection(b,a).length},i=function(){d=[];for(var b=[],c=0,f=null,g=0,i=a.selectedNumber.length,j=0;i>j;j++)b.push(a.selectedNumber[j].value);$.each(e,function(e,i){f=new Date(i.date);var j=h(b,i.numbers);c!==f.getMonth()&&(c=f.getMonth(),d.push({date:f.setDate(1),isWinningNumber:g}),g=0),j&&(g++,a.numOfAppear++),a.totalDraw++}),a.percentageDraw=(a.numOfAppear/a.totalDraw*100).toFixed(2)+"%"},j=function(){paintChart(d)};a.selectNumber=function(b){a.selectedNumber.length>=f.numofDraw&&(a.selectedNumber[0].selected=!1,a.selectedNumber=[]),b.selected=!0,a.numOfAppear=0,a.totalDraw=0,a.selectedNumber.push(b),a.numberEmpty=!1,i(),j()}}]);var luckNumServices=angular.module("luckNumServices",["ngResource"]);luckNumServices.factory("Records",["$resource",function(a){return a("data/649.json",{},{query:{method:"GET",isArray:!0}})}]);var paintChart=function(a){function b(){i.domain(p.empty()?j.domain():p.extent()),t.select(".area").attr("d",q),t.select(".x.axis").call(m)}var c={top:10,right:10,bottom:100,left:40},d={top:430,right:10,bottom:20,left:40},e=30,f=$(document).width();f=f>700?700:f,f=f-c.left-c.right-e;var g=$(document).height();g=g>500?500:g;var h=g-d.top-d.bottom;g=g-c.top-c.bottom;var i=d3.time.scale().range([0,f]),j=d3.time.scale().range([0,f]),k=d3.scale.linear().range([g,0]),l=d3.scale.linear().range([h,0]),m=d3.svg.axis().scale(i).orient("bottom"),n=d3.svg.axis().scale(j).orient("bottom"),o=d3.svg.axis().scale(k).orient("left"),p=d3.svg.brush().x(j).on("brush",b),q=d3.svg.area().interpolate("monotone").x(function(a){return i(a.date)}).y0(g).y1(function(a){return k(a.isWinningNumber)}),r=d3.svg.area().interpolate("monotone").x(function(a){return j(a.date)}).y0(h).y1(function(a){return l(a.isWinningNumber)});d3.select("svg").remove();var s=d3.select("#chartContent").append("svg").attr("width",f+c.left+c.right).attr("height",g+c.top+c.bottom);s.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",f).attr("height",g);var t=s.append("g").attr("class","focus").attr("transform","translate("+c.left+","+c.top+")"),u=s.append("g").attr("class","context").attr("transform","translate("+d.left+","+d.top+")");i.domain(d3.extent(a.map(function(a){return a.date}))),k.domain([0,d3.max(a.map(function(a){return a.isWinningNumber}))]),j.domain(i.domain()),l.domain(k.domain()),t.append("path").datum(a).attr("class","area").attr("d",q),t.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(m),t.append("g").attr("class","y axis").call(o),u.append("path").datum(a).attr("class","area").attr("d",r),u.append("g").attr("class","x axis").attr("transform","translate(0,"+h+")").call(n),u.append("g").attr("class","x brush").call(p).selectAll("rect").attr("y",-6).attr("height",h+7)};